<style>
    .navbar{
        margin-bottom:0;
    }
    
    a{
        color:white;
    }
    
    .btn{
        margin:20px;
    }
    
    
    .inputField2{
    margin-top:10px;
    border-radius:0;
    border:none;
    border-bottom:2px solid #bfbfbf;
    color:#333;
    background:none;
    padding:13px;
    font-size:1.2em;
    font-weight:500;
    width:100%;
    transition: all 0.3s ease;
    text-align:center;
}

input:focus + h4  {
  position: relative;
  top:-70px;
  font-size:1em;
}

.inputField2:focus{
  text-align:left;
}

.inputField2 + h4{
  position:relative;
  top:-37px;
  left:10px;
  display:inline;
  text-align:left;
}

.glyphicon-lock{
  top:2px;
}

.glyphicon-envelope{
  top:2px;
}

.glyphicon-bullhorn{
  top:2px;
}

.glyphicon-credit-card{
  top:3px;
}

.card_input{
  text-align:right;
}
</style>

<% if (current_user.id != 1) then %>
    
    <h1>You're not allowed in here!</h1>
    

<% else %>
  <%= render '/layouts/nav' %>
    
    
    
    
       
       
       <div id="map" style="width:100%;height:300px;"></div>
    <script>
    


      function initMap() {
          var address = "<%= @user.street %>, <%= @user.city %>, <%= @user.state %> <%= @user.zip %>";
          var geocoder = new google.maps.Geocoder();
          geocoder.geocode( { 'address': address}, function(results, status) {
  var location = results[0].geometry.location;
        var uluru = {lat: location.lat(), lng: location.lng()};
        var map = new google.maps.Map(document.getElementById('map'), {
          zoom: 7,
          center: uluru
        });
        var marker = new google.maps.Marker({
          position: uluru,
          map: map
        });
        
});
      }
      
    </script>
    <script async defer
    src="https://maps.googleapis.com/maps/api/js?key=AIzaSyBSBLy1SnCbXbZdill2bCZO8GgoCKnw4Q8&callback=initMap">
    </script>
    
    <div class="wrapper">
        <div class="container" style="margin-top:30px;margin-bottom:100px;">
            <center>
                    <% if (@user.banhammer == "true" || @user.banhammer == true) %>
                        <button class="btn btn-primary"><span class="glyphicon glyphicon-ok"></span>&nbsp;&nbsp;<%= link_to "Lift the Banhammer", :controller => "pages", :action => "lift_banhammer", :id => "#{@user.id}" %></button>
                    <% else %>
                        <button class="btn btn-primary"><span class="glyphicon glyphicon-remove"></span>&nbsp;&nbsp;<%= link_to "Bring Down the Banhammer", :controller => "pages", :action => "enact_banhammer", :id => "#{@user.id}" %></button>
                    <% end %>
            </center>
                <div style="background-color:#fff;padding:30px;border-radius:5px;" class="row">
                    <center>
                    <% if @user.completed %>
                        <% if (@user.completed == "true" || @user.completed == true) %>
                    <div class="gtag" style="margin:30px"><h3 style="color:white;font-size:22px;line-height:2.5"><span class="glyphicon glyphicon-ok"></span></h3></div>
                    <% end %>
                    <% end %>
                    <% if @user.banhammer %>
                        <% if (@user.banhammer == "true" || @user.banhammer == true) %>
                    <div class="gtag" style="margin:30px;background-color:#f55a58"><h3 style="color:white;font-size:22px;line-height:2.5">ðŸ”¨</h3></div>
                    <% end %>
                    <% end %>
                        <img src="<%= @user.image.url(:medium) %>" class="raised rounded" style="width:150px;margin:20px;height:auto;" />
                        <h1><%= @user.first_name %>&nbsp;<%= @user.last_name %>&nbsp;&nbsp;(<%= @user.age %>)</h1>
                        <h3><%= @user.email %></h3>
                        <div style="margin:40px;">
                        <h1 style="background:#6d6d6d;width:101px;-webkit-background-clip: text;-webkit-text-fill-color: transparent;"><%= ((@user.progress.to_f / Lesson.all.count.to_f)*100).round %>%</h1>
                        <div style="height:8px;width:60%;background-color:#eaeaea;border-radius:4px;overflow:hidden;">
                            <div style="background:#bfbfbf;width:<%= ((@user.progress.to_f / Lesson.all.count.to_f)*100) %>%;height:100%;float:left;border-radius:4px;">
                    
                            </div>
                        </div>
                        </div>
                        <h3 style="margin-bottom:20px">(<%= @user.phone[0..2] %>)&nbsp;<%= @user.phone[3..5] %>-<%= @user.phone[6..9] %></h3>
                        <h4><%= @user.street %></h4>
                        <h4><%= @user.city %>,&nbsp;<span style="text-transform: uppercase"><%= @user.state %></span>&nbsp;&nbsp;<%= @user.zip %></h4>
                        <% if @user.referral != "" %>
                            <h3>Referred by: <%= @user.referral %></h3>
                        <% end %>
                        
                        
                    <% if @user.auto_renew %>
                        <% if (@user.auto_renew == "true" || @user.auto_renew == true) %>
                    <div class="gtag" style="margin:50px;margin-bottom:20px"><h3 style="color:white;font-size:22px;line-height:2.5"><span class="glyphicon glyphicon-repeat"></span></h3></div>
                    <% end %>
                    <% end %>
                    <% if @user.auto_renew %>
                        <% if (@user.auto_renew == "false" || @user.auto_renew == false) %>
                    <div class="gtag" style="margin:50px;margin-bottom:20px;background-color:#f55a58"><h3 style="color:white;font-size:22px;line-height:2.5"><span class="glyphicon glyphicon-repeat"></span></h3></div>
                    <% end %>
                    <% end %>
                        
                        <% if @user.card_number && @user.card_number != "" %>
                        <div class="row">
                        <div class="col-md-3"></div>
                        <div class="col-md-6" style="margin-top:0px;background-color:#d6d6d6;border-radius:10px;padding-bottom:20px">
                            <div class="row">
                                <div class="row" style="margin-top:15px">
                                    <div class="col-xs-6">
                                        <% if @user.card_number[0] == "4" %>
                                            <img src="/visa.png" style="max-height:70px;height:100%;width:auto" />
                                        <% elsif @user.card_number[0..1] == "34" || @user.card_number[0..1] == "37" %>
                                            <img src="/amex.png" style="max-height:70px;height:100%;width:auto" />
                                        <% elsif @user.card_number[0..3] == "6011" || @user.card_number[0..1] == "65" %>
                                            <img src="/discover.png" style="max-height:70px;height:100%;width:auto" />
                                        <% else %>
                                            <img src="/mastercard.png" style="max-height:70px;height:100%;width:auto" />
                                        <% end %>
                                </div>
                                <div class="col-xs-6">
                                        <h2 style="text-align:right;font-size:20px"><span style="padding:5px;padding-left:10px;padding-right:10px;border-radius:10px;background-color:#bdbdbd;">CVV</span>&nbsp;<%= @user.card_cvv %></h2>
                                </div>
                                </div>
                                <div class="col-md-12" style="margin-top:15px;margin-bottom:25px;">
                                    <center>
                                        <h2><%= @user.card_number %></h2>
                                    </center>
                                </div>
                                <div class="row">
                                    <div class="col-xs-6">
                                    <h2 style="font-size:24px;text-transform:uppercase"><%= @user.card_name %></h2>
                                </div>
                                <div class="col-xs-6">
                                    <h2 style="font-size:24px;text-align:right"><%= @user.card_exp_month %>&nbsp;/&nbsp;<%= @user.card_exp_year %></h2>
                                </div>
                                </div>
                            </div>
                        </div>
                        <div class="col-md-3"></div>
                    </div>
                    <center>
                        <% if @user.promo != "" %>
                            <h2>Promo Code: <b><%= @user.promo %></b></h2>
                        <% end %>
                    </center>
                    <% end %>
                    
                    <%= form_for @user, url: { action: 'update', controller: 'devise/registrations'}, method: :put, :validate => false do |f| %>
                    <div class="div_base">
                    <div class="row">
                      <div class="col-md-12">
                        <%= f.text_field :promo, autocomplete: "off", :class => "inputField2" %>
                        <h4 class = "text_overlay"><span class="glyphicon glyphicon-bullhorn"></span>&nbsp;&nbsp;Promo Code</h4>
                      </div>
                    </div>
                    
                    <div class="row">
                      <div class="col-md-12">
                        <%= f.text_field :card_name, autocomplete: "off", :class => "inputField2" %>
                        <h4 class = "text_overlay"><span class="glyphicon glyphicon-user"></span>&nbsp;&nbsp;Name on Card</h4>
                      </div>
                    </div>
                    
                    <div class="row">
                      <div class="col-sm-8">
                        <%= f.telephone_field :card_number, :id => "card_input", autocomplete: "off", :class => "inputField2 card_input", :maxlength => "19", :onkeydown => "return isNumber(event);" %>
                        <h4 class = "text_overlay"><span class="glyphicon glyphicon-credit-card"></span>&nbsp;&nbsp;Card Number</h4>
                      </div>
                      <div class="col-sm-4" style="padding-top:19px;padding-bottom:19px;border-bottom:2px solid #bfbfbf;">
                        <%= f.select :card_exp_month, ['Month','01','02','03','04','05','06','07','08','09','10','11','12'], :class => "inputField2" %><span>&nbsp;/&nbsp;</span>
                        <%= f.select :card_exp_year, ['Year','18','19','20','21','22','23'], :class => "inputField2", :style => "display: inline" %>
                      </div>
                    </div>
                    <div class="row">
                      <div class="col-sm-8">
                                            <img src="/tran.png" id="hot_img" style="max-height:70px;height:100%;width:auto" />
                      </div>
                      <div class="col-sm-4" style="padding:0">
                        <%= f.telephone_field :card_cvv, autocomplete: "off", :class => "inputField2", :style=>"text-align:right", :maxlength => "4", :onkeydown => "return isNumber(event);" %>
                        <h4 class = "text_overlay"><span class="glyphicon glyphicon-lock"></span> &nbsp;CVV</h4>
                      </div>
                    </div>

                        <button class="btn btn-primary"><%= f.submit "Create account", :class => "btn-lg btn-primary", :id => "#{params[:id]}" %></button>
                      </div>
                    <% end %>
                    
                    </center>
                </div>
        </div>
    </div>



<% end %>

<script>
    $('.card_input').on('keyup', function() {
  var foo = $(this).val().split(" ").join(""); 
  if (foo.length > 0) {
    foo = foo.match(new RegExp('.{1,4}', 'g')).join(" ");
  }
  $(this).val(foo);
});

function isNumber(event) {
  
  var inp = document.getElementById("card_input").value;
                                        
  if (inp.substring(0,1) == "4") {
    document.getElementById('hot_img').src="/visa.png";
  } else if (inp.substring(0,2) == "34" || inp.substring(0,2) == "37") {
    document.getElementById('hot_img').src="/amex.png";
  } else if (inp.substring(0,4) == "6011" || inp.substring(0,2) == "65") {
    document.getElementById('hot_img').src="/discover.png";
  } else {
    document.getElementById('hot_img').src="/mastercard.png";
  }
                                        
                                        
  if (event) {
    var charCode = (event.which) ? event.which : event.keyCode;
    if (charCode != 190 && charCode > 31 && 
       (charCode < 48 || charCode > 57) && 
       (charCode < 96 || charCode > 105) && 
       (charCode < 37 || charCode > 40) && 
        charCode != 110 && charCode != 8 && charCode != 46 )
       return false;
  }
  return true;
}
</script>